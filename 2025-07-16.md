## ELK + Filebeatë¡œ Spring Boot ë¡œê·¸ ìˆ˜ì§‘í•˜ê¸° (2025-07-16)

###  Spring Boot ë¡œê·¸ë¥¼ Filebeat â†’ Logstash â†’ Elasticsearch â†’ Kibanaë¡œ ì—°ë™í•´ ìˆ˜ì§‘í•˜ê³  ì‹œê°í™”í•˜ëŠ” ê³¼ì •

### âœ… ëª©í‘œ
Spring Boot ë¡œê·¸ë¥¼ ELK Stackìœ¼ë¡œ ì¤‘ì•™ ìˆ˜ì§‘

Filebeatë¡œ ë¡œê·¸ íŒŒì¼ ìˆ˜ì§‘

Logstashë¡œ íŒŒì‹± ë° Elasticsearch ì €ì¥

Kibanaì—ì„œ ì‹¤ì‹œê°„ ì‹œê°í™”

### ğŸ”§ 1. ë¡œê·¸ í¬ë§· êµ¬ì„±
/app/logs/app.log ìœ„ì¹˜ì— JSON í¬ë§·ìœ¼ë¡œ ë¡œê·¸ë¥¼ ì €ì¥í•¨ (ì˜ˆ: Logback ì‚¬ìš© ì‹œ JSON encoder ì„¤ì • í•„ìš”)

### ğŸ³ 2. Docker Network êµ¬ì„±
bash
```
docker network create logging-net
```
ëª¨ë“  ì»¨í…Œì´ë„ˆê°€ logging-netì´ë¼ëŠ” ì™¸ë¶€ ë¸Œë¦¬ì§€ ë„¤íŠ¸ì›Œí¬ë¥¼ ê³µìœ í•˜ê²Œ ì„¤ì •

ğŸ“¦ 3. docker-compose.yml - ELK êµ¬ì„±
yaml
```
version: '3.8'

services:
elasticsearch:
image: docker.elastic.co/elasticsearch/elasticsearch:8.13.0
environment:
- discovery.type=single-node
- xpack.security.enabled=false
- TZ=Asia/Seoul
- ES_JAVA_OPTS=-Xms1g -Xmx1g
ports:
- "9200:9200"
volumes:
- esdata:/usr/share/elasticsearch/data
networks:
- logging-net

kibana:
image: docker.elastic.co/kibana/kibana:8.13.0
environment:
- ELASTICSEARCH_HOSTS=http://elkserver-elasticsearch-1:9200
- TZ=Asia/Seoul
ports:
- "5601:5601"
depends_on:
- elasticsearch
networks:
- logging-net

logstash:
image: docker.elastic.co/logstash/logstash:8.13.0
volumes:
- ./logstash/pipeline:/usr/share/logstash/pipeline
ports:
- "5044:5044"
- "9600:9600"
depends_on:
- elasticsearch
networks:
- logging-net

volumes:
esdata:

networks:
logging-net:
external: true

```
### ì£¼ì˜ : logging-netì€ external: true ì„¤ì • í•„ìš”. ì—†ì„ ê²½ìš° composeê°€ network label ì¶©ëŒë¡œ ì‹¤í–‰ ì•ˆ ë¨.

#### âš™ï¸ 4. Logstash ì„¤ì • (logstash.conf)
conf
```
input {
beats {
port => 5044
}
}

filter {
json {
source => "message"
}
date {
match => ["@timestamp", "ISO8601"]
}
mutate {
remove_field => ["host", "agent", "input", "ecs", "log", "tags"]
}
}

output {
elasticsearch {
hosts => ["http://elasticsearch:9200"]
index => "springboot-logs-%{+YYYY.MM.dd}"
}
stdout { codec => rubydebug }
}
```
#### ğŸ“¦ 5. Filebeat ì„¤ì • (filebeat.yml)
yaml
```
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /app/logs/*.log
      json.keys_under_root: true
      json.add_error_key: true
      json.message_key: message

output.logstash:
hosts: ["logstash:5044"]

setup.kibana:
host: "http://kibana:5601"

logging.level: info
logging.to_files: true
logging.files:
path: /usr/share/filebeat/logs
name: filebeat.log
keepfiles: 7
permissions: 0644

```
#### ğŸš«-> Filebeatë„ ë™ì¼í•œ logging-net ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ë˜ì–´ì•¼ í•¨ 

### ğŸ” 6. ìƒíƒœ í™•ì¸ ë° ë¬¸ì œ í•´ê²°
âœ… ì •ìƒ ë¡œê·¸ ìˆ˜ì§‘ ì‹œ
Kibanaì—ì„œ .ds-filebeat-8.13.0-* ì¸ë±ìŠ¤ë¥¼ í†µí•´ ë¡œê·¸ í™•ì¸ ê°€ëŠ¥

json
```
{
"@timestamp": "2025-07-16T08:28:48.274Z",
"log.file.path": "/app/logs/app.log",
"message": "Resolving eureka endpoints via configuration"
}
```

## âŒ ì˜¤ë¥˜ ì˜ˆì‹œ ë° í•´ê²°
Elasticsearch Unreachable: Filebeat/Logstashê°€ Elasticsearchì— ì—°ê²° ì‹¤íŒ¨ â†’ DNS ì´ë¦„ í™•ì¸ (elkserver-elasticsearch-1)

docker-composeì—ì„œ external network ì˜¤ë¥˜ â†’ external: trueë¡œ ëª…ì‹œ í•„ìš”

Filebeat ë¡œê·¸ê°€ JSON íŒŒì‹± ì•ˆ ë  ì‹œ â†’ json.message_key, json.keys_under_root í™•ì¸ 

**<< Jsoní˜•íƒœë¡œ ë°›ëŠ” messageì™€ ë‹¤ë¥¸ í˜•íƒœë¡œ ë“¤ì–´ì™€ ì¸ì‹í•  ìˆ˜ ì—†ì—ˆìŒ >>**

# ğŸ“Œ ëŠë‚€ ì 
Docker ë„¤íŠ¸ì›Œí¬ ì´ë¦„ ì¶©ëŒê³¼ ì»¨í…Œì´ë„ˆ ë‚´ ì„œë¹„ìŠ¤ DNS ì´ë¦„ ì£¼ì˜!

ELK êµ¬ì„± ìì²´ëŠ” ì–´ë µì§€ ì•Šì§€ë§Œ ê° ìš”ì†Œ ê°„ ì—°ê²°ì„ ê¼¼ê¼¼íˆ í™•ì¸í•´ì•¼ í•¨

Logstash í•„í„° ì„¤ì •ì€ Kibana í•„ë“œ í´ë¦°ì—…ì— ë§¤ìš° ì¤‘ìš”